# Author: Rhydian Brown
import ipaddress

def parse_ip(ip_input):
    if isinstance(ip_input, list):
        return ip_input

    if ',' in ip_input:
        # list of ips
        return [str(ipaddress.ip_address(x.strip())) for x in ip_input.split(',')]

    if '-' in ip_input:
        ip_range = ip_input.split('-')
        if len(ip_range) != 2:
            raise ValueError("Invalid format for IP range")

        start_ip = ipaddress.ip_address(ip_range[0])
        end_ip = ipaddress.ip_address(ip_range[1])

        return [str(ip.network_address) for ip in ipaddress.summarize_address_range(start_ip, end_ip)]

    if '/' in ip_input:
        # CIDR range
        return [str(ip) for ip in ipaddress.ip_network(ip_input, strict=False).hosts()]

    # single ip
    return [str(ipaddress.ip_address(ip_input))]


def list_of_ports(x):
    if '-' in x:
        # treat it as a range
        parts = x.split('-')
        if len(parts) != 2:
            raise ValueError("Malformed range")

        min = int(parts[0])
        max = int(parts[1])

        return range(min, max)

    return [int(n.strip()) for n in x.split(',')]
